[{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003ereactのJSXの中で条件分岐に使う便利ツールです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"問題提起\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E6%8F%90%E8%B5%B7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題提起\u003c/h1\u003e\n\n\u003cp\u003ereact+jsxで、例えばあるボタンを、ユーザーの権限が無い時使用不能にし、かつクラスをつけて見た目も変えたいとします。多分こんな感じのコードになるんじゃないでしょうか？\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"jsx\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eclassNames\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'btn btn-primary'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003edeny\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ecan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'manage'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'guest'\u003c/span\u003e\u003cspan class=\"p\"\u003e)})}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'manage'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'guest'\u003c/span\u003e\u003cspan class=\"p\"\u003e)){\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleSendButton\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshowAclError\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"err\"\u003e送信\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/button\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコードの問題点は同じ条件分岐\u003ccode\u003ecan('manage', 'guest')\u003c/code\u003eが二箇所に書かれていることです。\u003c/p\u003e\n\n\u003cp\u003eこれを一つのIF文で分岐することも可能ですが・・・\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"jsx\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ecan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'manage'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'guest'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ebutton\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclassName=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"btn btn-primary deny\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eonClick=\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleSendButton\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    送信\n  \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ebutton\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclassName=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"btn btn-primary\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eonClick=\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleSendButton\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    送信\n  \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今度はタグや子要素が二つ複製されて変更が面倒になります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"解決策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決策\u003c/h1\u003e\n\n\u003cp\u003e下記のようにかけるようなツールを作りました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"jsx\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{...\u003c/span\u003e\u003cspan class=\"nx\"\u003e_if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'manage'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'guest'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eonClick\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleSendButton\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eonClick\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshowAclError\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclassName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'deny'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclassName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassNames\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'btn btn-primary'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e送信\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/button\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e_if()\u003c/code\u003eの最初の引数がtrueだったら2番目の引数のオブジェクトが、falseだったら\u003ccode\u003eelse()\u003c/code\u003eのオブジェクトがプロパティーに採用されます。\u003ccode\u003eany()\u003c/code\u003eには前段の\u003ccode\u003eif/else/(elsif)\u003c/code\u003eで採用された値を引数に関数が呼び出され、その返り値がプロパティーの値になります。関数を使って値を加工しつつマージするようなイメージです。\u003c/p\u003e\n\n\u003cp\u003eselectタグなんかは権限のないときは\u003ccode\u003emousedown\u003c/code\u003eで\u003ccode\u003epreventDefault\u003c/code\u003eして警告を出したい時なんかもあります。そんなときはこんな風にもかけます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"jsx\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eselect\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{...\u003c/span\u003e\u003cspan class=\"nx\"\u003e_if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecan\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'manage'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'guest'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eonChange\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleChangeSelect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eonMouseDown\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshowAclError\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eonChange\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e \u003cspan class=\"c1\"\u003e//valueがあってonChangeがないと警告がでるので\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclassName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'deny'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eclassName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassNames\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'form-control'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eselected\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eoption\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"foo\"\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003efoo\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e/\u003c/span\u003e\u003cspan class=\"nt\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e実装はこんな感じです。今回例にはあげてませんが\u003ccode\u003eelsif\u003c/code\u003eもあります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eConditionalObject\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econditions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eanyObject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eelsif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eanyObject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003e_processAny\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etargetObject\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{...\u003c/span\u003e\u003cspan class=\"nx\"\u003etargetObject\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eanyObject\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// anyは関数。決定したpropsを引数に呼び出し上書きします。\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eanyObject\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eyield\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econditions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e_processAny\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003e_if\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eConditionalObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econdition\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e単純に、条件分岐で返すオブジェクトを変更する仕組み、ということでしょうか。classNameを想定して\u003ccode\u003eany\u003c/code\u003eは関数を渡すようにしたところが唯一の工夫ですかね。\u003c/p\u003e\n\n\u003cp\u003e関係ないけど\u003ccode\u003eany\u003c/code\u003eの名前は悩みました。\u003ccode\u003emerge\u003c/code\u003e, \u003ccode\u003edefault\u003c/code\u003e \u003ccode\u003efinally\u003c/code\u003e \u003ccode\u003eboth\u003c/code\u003e \u003ccode\u003eeither\u003c/code\u003eとか・・・\u003ccode\u003eany\u003c/code\u003eも含め正直どれもピンとこなかったのでタイプ量で\u003ccode\u003eany\u003c/code\u003eにしたのが正直なところです。ネイティブな人だったら何にするんだろうか？あと念のためですが\u003ccode\u003eelsif\u003c/code\u003eはタイポではありません。\u003c/p\u003e\n","body":"# \b概要\n\nreactのJSXの中で条件分岐に使う便利ツールです。\n\n# 問題提起\n\nreact+jsxで、例えばあるボタンを、ユーザーの権限が無い時使用不能にし、かつクラスをつけて見た目も変えたいとします。多分こんな感じのコードになるんじゃないでしょうか？\n\n```jsx\n\u003cbutton\n  className={classNames('btn btn-primary', {deny: can('manage', 'guest')})}\n  onClick={e =\u003e {\n    if(can('manage', 'guest')){\n      this.handleSendButton()\n    } else {\n      this.showAclError()\n    }\n  }}\n\u003e\n  送信\n\u003c/button\u003e\n```\n\nこのコードの問題点は同じ条件分岐`can('manage', 'guest')`が二箇所に書かれていることです。\n\nこれを一つのIF文で分岐することも可能ですが・・・\n\n```jsx\n{can('manage', 'guest') ? (\n  \u003cbutton\n    className=\"btn btn-primary deny\"\n    onClick={e =\u003e this.handleSendButton()}\n  \u003e\n    送信\n  \u003c/button\u003e\n) : (\n  \u003cbutton\n    className=\"btn btn-primary\"\n    onClick={e =\u003e this.handleSendButton()}\n  \u003e\n    送信\n  \u003c/button\u003e\n)}\n```\n\n今度はタグや子要素が二つ複製されて変更が面倒になります。\n\n# 解決策\n\n下記のようにかけるようなツールを作りました。\n\n```jsx\n\u003cbutton\n  {..._if(can('manage', 'guest'), {\n    onClick: e =\u003e this.handleSendButton()\n  }).else({\n    onClick: e =\u003e this.showAclError(),\n    className: 'deny'\n  }).any({\n    className: v =\u003e classNames(v, 'btn btn-primary')\n  })}\n\u003e送信\u003c/button\u003e\n```\n\n`_if()`の最初の引数がtrueだったら2番目の引数のオブジェクトが、falseだったら`else()`のオブジェクトがプロパティーに採用されます。`any()`には前段の`if/else/(elsif)`で採用された値を引数に関数が呼び出され、その返り値がプロパティーの値になります。関数を使って値を加工しつつマージするようなイメージです。\n\nselectタグなんかは権限のないときは`mousedown`で`preventDefault`して警告を出したい時なんかもあります。そんなときはこんな風にもかけます。\n\n```jsx\n\u003cselect\n  {..._if(can('manage', 'guest'), {\n    onChange: e =\u003e this.handleChangeSelect(e)\n  }).else({\n    onMouseDown: e =\u003e this.showAclError(),\n    onChange: () =\u003e {}, //valueがあってonChangeがないと警告がでるので\n    className: 'deny'\n  }).any({\n    className: v =\u003e classNames(v, 'form-control')\n  })}\n  value={this.props.selected}\n\u003e\n  \u003coption value=\"foo\"\u003efoo\u003c/option\u003e\n\u003c/select\u003e\n```\n\n実装はこんな感じです。今回例にはあげてませんが`elsif`もあります。\n\n```js\nclass ConditionalObject\n{\n  constructor(condition, props){\n    this.conditions = []\n\n    this.conditions.push({\n      condition: condition,\n      props: props\n    })\n    \n    this.anyObject = {}\n  }\n\n  elsif(condition, props){\n    this.conditions.push({\n      condition: condition,\n      props: props\n    })\n    return this\n  }\n\n  else(props){\n    this.conditions.push({\n      condition: true,\n      props: props\n    })\n    return this\n  }\n\n  any(props){\n    this.anyObject = props\n    return this\n  }\n\n  _processAny(targetObject){\n    const props = {...targetObject}\n\n    for(var key in this.anyObject){\n      // anyは関数。決定したpropsを引数に呼び出し上書きします。\n      props[key] = this.anyObject[key](props[key])\n    }\n\n    return props\n  }\n  \n  yield(){\n    const result = this.conditions.find(cond =\u003e cond.condition)\n    return this._processAny(result.props)\n  }\n}\n\n\nexport default function _if(condition, props){\n  return new ConditionalObject(condition, props)\n}\n```\n\n単純に、条件分岐で返すオブジェクトを変更する仕組み、ということでしょうか。classNameを想定して`any`は関数を渡すようにしたところが唯一の工夫ですかね。\n\n関係ないけど`any`の名前は悩みました。`merge`, `default` `finally` `both` `either`とか・・・`any`も含め正直どれもピンとこなかったのでタイプ量で`any`にしたのが正直なところです。ネイティブな人だったら何にするんだろうか？あと念のためですが`elsif`はタイポではありません。\n\n","coediting":false,"comments_count":0,"created_at":"2019-03-31T23:11:27+09:00","group":null,"id":"0cb73a958b1cf0f02d89","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"JavaScript","versions":[]},{"name":"JSX","versions":[]},{"name":"es6","versions":[]},{"name":"React","versions":[]}],"title":"reactで同じ条件で複数のプロパティーを分岐する","updated_at":"2019-03-31T23:14:41+09:00","url":"https://qiita.com/MasamotoMiyata/items/0cb73a958b1cf0f02d89","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":8,"github_login_name":"gomo","id":"MasamotoMiyata","items_count":30,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":5336,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/5336/profile-images/1504693849","team_only":false,"twitter_screen_name":"MasamotoMiyata","website_url":""},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eReactとReduxを実業務で使用していて、そのフォルダ構成について説明したいと思います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAPIの呼び出しにはredux-sagaを使用し、\u003c/li\u003e\n\u003cli\u003eコンポーネントの分類にはAtomic Designを採用しています。\u003c/li\u003e\n\u003cli\u003e多人数で開発しやすいよう、action/reducer/sagaのファイルは極力分割しています。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ディレクトリ構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eディレクトリ構成\u003c/h1\u003e\n\n\u003cp\u003e先にディレクトリ構成を記述して、その後詳細を説明していきます。\u003cbr\u003e\nこの記事は、例としてプロジェクトのタスク管理アプリを想定したファイル名やモデル名を記述します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e- action/\n- component/\n   - atoms/\n   - molecules/\n   - organism/\n   - templates/\n   - pages/\n- container/\n- reducer/\n- saga/\n- libs/\n   - common/\n   - model/\n   - service/\n   - api/\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"reactredux-に関するディレクトリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#reactredux-%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eReact/Redux に関するディレクトリ\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"actioncomponentcontainerreducer\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#actioncomponentcontainerreducer\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAction/Component/Container/Reducer\u003c/h2\u003e\n\n\u003cp\u003eReduxの役割ごとにディレクトリを構成しています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eaction ... acitonとaction creatorを格納します。ドメインごとに小分けで用意し、index.jsで結合します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./user.js\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./project.js\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./task.js\"\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eproject.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eCREATE_USER_START_EVENT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"CREATE_USER_START_EVENT\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eCREATE_USER_SUCCESS_EVENT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"CREATE_USER_SUCCESS_EVENT\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eCREATE_USER_FAILURE_EVENT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"CREATE_USER_FAILURE_EVENT\"\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserStartEvent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eCREATE_USER_START_EVENT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003ecomponents ... Atomic Designの５分類のサブディレクトリを構成します。\u003c/li\u003e\n\u003cli\u003econtainer ... containerを格納します。\u003c/li\u003e\n\u003cli\u003ereducer ... reducerを格納します。ファイルはcombineReducers関数を使って小分けに定義します。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ereducer/index.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ecombineReducers\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"redux\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003euserState\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./userState\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eprojectState\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./projectState\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003etaskState\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./taskState\"\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eappState\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecombineReducers\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003euserState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eprojectState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etaskState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"nx\"\u003eappState\u003c/span\u003e\n\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"saga\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#saga\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003esaga\u003c/h2\u003e\n\n\u003cp\u003esagaのハンドラとなるジェネレーター関数とそのforkを行うファイルを格納します。\u003cbr\u003e\nこれも、以下のようにして小分けにします。\u003cbr\u003e\nsaga.jsでイベントハンドラ関数を順次forkしています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esaga.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserSaga\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./userSaga\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eProjectSaga\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./projectSaga\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eTaskSaga\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"./taskSaga\"\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003erootSaga\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esagaFucntions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eUserSaga\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eProjectSaga\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eTaskSaga\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// forkに登録\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esagaFuncs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"nx\"\u003efork\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esagaFuncs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003euserSaga.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003efunc\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleCreateUserEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eaction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"nx\"\u003etake\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eCREATE_USER_START_EVENT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreatedUser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"nx\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eUserService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateUserAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"nx\"\u003eput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateUserSuccessEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreatedUser\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"nx\"\u003eput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateUserFailureEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ... \u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserSaga\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003esagaFunctions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ehandleCreateUser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ehandleUpdateUser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ehandleDeleteUser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"atomic-design\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#atomic-design\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAtomic Design\u003c/h2\u003e\n\n\u003cp\u003eAtomic Designとは、componentの分類手法で、化学に例えて５つに分類します。\u003cbr\u003e\n詳細は以下を参照してください。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://atomicdesign.bradfrost.com/chapter-2/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://atomicdesign.bradfrost.com/chapter-2/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eディレクトリ構成は以下の５つです。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eatoms/ ... 原子＝それ以上分離できない最小のコンポーネント（テキストボックス、ボタン）\u003c/li\u003e\n\u003cli\u003emolecules/ ... 分子＝原子の組み合わせ（検索ボタン付きのテキストボックス）\u003c/li\u003e\n\u003cli\u003eorganisms/ ... 組織＝そのままで画面部品となりえるもの（ロゴと検索バー、検索リストのテーブル）\u003c/li\u003e\n\u003cli\u003etemplates/ ... テンプレート＝ページの元となるもの。組織、分子、原子を置ける。\u003c/li\u003e\n\u003cli\u003epages/ ... ページ＝テンプレートに情報を付加したもの。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"libs-ディレクトリ自作のライブラリを格納するディレクトリ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#libs-%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E8%87%AA%E4%BD%9C%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E6%A0%BC%E7%B4%8D%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003elibs ディレクトリ（自作のライブラリを格納するディレクトリ）\u003c/h1\u003e\n\n\u003cp\u003ecommonには、ID生成やI18n用や、数値フォーマットのメソッド等を入れます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e- libs/\n   - common/\n     - idutil.js\n     - i18n.js\n     - formater.js\n   - model/\n     - user.js\n     - project.js\n     - task.js\n   - service/\n     - userService.js\n     - projectService.js\n     - taskService.js\n     - converter/\n       - userConverter.js\n       - projectConverter.js\n       - taskConverter.js\n   - api/\n     - userApi.js\n     - projectAndTaskApi.js\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"model層とservice層とapi層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#model%E5%B1%A4%E3%81%A8service%E5%B1%A4%E3%81%A8api%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eModel層とService層とAPI層\u003c/h2\u003e\n\n\u003cp\u003e以下の３層に分離しまています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eReactのコンポーネントで表示しやすいビューのためのモデル\u003c/li\u003e\n\u003cli\u003eロジックとビューモデルを扱うService、APIを呼び出す。\n\n\u003cul\u003e\n\u003cli\u003eServiceのモデルとAPIのリクエストとレスポンスを変換するConverter \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eServiceから呼び出され、バックエンドのAPIを呼ぶAPI層\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"model層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#model%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eModel層\u003c/h3\u003e\n\n\u003cp\u003eビュー用のモデルを定義します。例えばUser,Project,Taskなどです。\u003cbr\u003e\nES2015のクラスで定義しています。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003euser.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eUser\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eid\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epassword\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eemail\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"service層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#service%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eService層\u003c/h3\u003e\n\n\u003cp\u003eビュー用モデルやそのパラメータを使ってロジックを実行する層です。\u003cbr\u003e\n非同期メソッドの場合は、createUserAsyncなどのようにAsyncをつけて命名します。\u003cbr\u003e\nAPI層を呼び出す前に、Converterでリクエストとレスポンスを変換します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"service層のconverter\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#service%E5%B1%A4%E3%81%AEconverter\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eService層のConverter\u003c/h3\u003e\n\n\u003cp\u003eAPIとサービスの橋渡しを行います。\u003cbr\u003e\nほとんどのメソッドは、パラメータやビューモデルと、リクエストとレスポンスの変換を行うだけになります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"api層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#api%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPI層\u003c/h3\u003e\n\n\u003cp\u003eバックエンドのAPIを呼び出すメソッドです。\u003c/p\u003e\n\n\u003cp\u003eServiceとAPIとConverterは以下のようなコードになります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003euserService.js\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserService\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n  \u003cspan class=\"kr\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserAsync\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003erequest\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econvertParamsToCreateUserRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserApi\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreatedUser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econvertCreateUserResponseToUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreatedUser\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e}))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003eこの構成で半年近く実装していますが、特に違和感なく使えています。\u003cbr\u003e\n特にレイヤー化することで、以下の恩恵を受けています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eModelとAPIの密結合を防ぐ\u003c/li\u003e\n\u003cli\u003eAPI変更は、API層とConverterのみにとじられる\u003c/li\u003e\n\u003cli\u003eロジックはServiceに集約されるので、SagaやReducerが肥大化しない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの構成の例が参考になれば幸いです\u003c/p\u003e\n","body":"# 概要\nReactとReduxを実業務で使用していて、そのフォルダ構成について説明したいと思います。\n\n- APIの呼び出しにはredux-sagaを使用し、\n- コンポーネントの分類にはAtomic Designを採用しています。\n- 多人数で開発しやすいよう、action/reducer/sagaのファイルは極力分割しています。\n\n# ディレクトリ構成\n先にディレクトリ構成を記述して、その後詳細を説明していきます。\nこの記事は、例としてプロジェクトのタスク管理アプリを想定したファイル名やモデル名を記述します。\n\n\n```\n- action/\n- component/\n   - atoms/\n   - molecules/\n   - organism/\n   - templates/\n   - pages/\n- container/\n- reducer/\n- saga/\n- libs/\n   - common/\n   - model/\n   - service/\n   - api/\n```\n\n# React/Redux に関するディレクトリ\n\n## Action/Component/Container/Reducer\nReduxの役割ごとにディレクトリを構成しています。\n\n- action ... acitonとaction creatorを格納します。ドメインごとに小分けで用意し、index.jsで結合します。\n\n```js:index.js\nexport * from \"./user.js\"\nexport * from \"./project.js\"\nexport * from \"./task.js\"\n```\n\n```js:project.js\nexport const CREATE_USER_START_EVENT = \"CREATE_USER_START_EVENT\"\nexport const CREATE_USER_SUCCESS_EVENT = \"CREATE_USER_SUCCESS_EVENT\"\nexport const CREATE_USER_FAILURE_EVENT = \"CREATE_USER_FAILURE_EVENT\"\n// ...\n\nexport  const createUserStartEvent = (name, password, email) =\u003e ({\n  type: CREATE_USER_START_EVENT,\n  payload: {\n    name: name,\n    password: password,\n    email: email\n  },\n})\n\n// ...\n```\n\n- components ... Atomic Designの５分類のサブディレクトリを構成します。\n- container ... containerを格納します。\n- reducer ... reducerを格納します。ファイルはcombineReducers関数を使って小分けに定義します。\n\n```js:reducer/index.js\nimport { combineReducers } from \"redux\"\nimport userState from \"./userState\"\nimport projectState from \"./projectState\"\nimport taskState from \"./taskState\"\n\nconst appState = combineReducers({\n  userState,\n  projectState,\n  taskState,\n})\n\nexport default appState\n\n```\n## saga\nsagaのハンドラとなるジェネレーター関数とそのforkを行うファイルを格納します。\nこれも、以下のようにして小分けにします。\nsaga.jsでイベントハンドラ関数を順次forkしています。\n\n```js:saga.js\nimport UserSaga from \"./userSaga\"\nimport ProjectSaga from \"./projectSaga\"\nimport TaskSaga from \"./taskSaga\"\n\nexport default function* rootSaga() {\n  let sagaFunctions = []\n  sagaFunctions = sagaFucntions.concat(UserSaga.sagaFunctions())\n  sagaFunctions = sagaFunctions.concat(ProjectSaga.sagaFunctions())\n  sagaFunctions = sagaFunctions.concat(TaskSaga.sagaFunctions())\n  \n  // forkに登録\n  for (let i = 0; i \u003c sagaFuncs.length; i++) {\n    yield fork(sagaFuncs[i])\n  }}\n}\n```\n\n```js:userSaga.js\nfunc *handleCreateUserEvent() {\n  const action = yield take(CREATE_USER_START_EVENT)\n  const {createdUser, err} = yield call(\n    UserService.createUserAsync,\n    action.payload.name,\n    action.payload.password,\n    action.payload.email,\n  }\n  if(!err) {\n    yield put(createUserSuccessEvent(createdUser))\n  } else {\n    yield put(createUserFailureEvent(err))\n  }\n}\n// ... \n\nclass UserSaga {\n  static sagaFunctions = () =\u003e {\n    return [\n      handleCreateUser,\n      handleUpdateUser,\n      handleDeleteUser,\n      // ...\n    ]\n  }\n```\n\n## Atomic Design\nAtomic Designとは、componentの分類手法で、化学に例えて５つに分類します。\n詳細は以下を参照してください。\n\n- http://atomicdesign.bradfrost.com/chapter-2/\n\nディレクトリ構成は以下の５つです。\n\n- atoms/ ... 原子＝それ以上分離できない最小のコンポーネント（テキストボックス、ボタン）\n- molecules/ ... 分子＝原子の組み合わせ（検索ボタン付きのテキストボックス）\n- organisms/ ... 組織＝そのままで画面部品となりえるもの（ロゴと検索バー、検索リストのテーブル）\n- templates/ ... テンプレート＝ページの元となるもの。組織、分子、原子を置ける。\n- pages/ ... ページ＝テンプレートに情報を付加したもの。\n\n# libs ディレクトリ（自作のライブラリを格納するディレクトリ）\ncommonには、ID生成やI18n用や、数値フォーマットのメソッド等を入れます。\n\n```\n- libs/\n   - common/\n     - idutil.js\n     - i18n.js\n     - formater.js\n   - model/\n     - user.js\n     - project.js\n     - task.js\n   - service/\n     - userService.js\n     - projectService.js\n     - taskService.js\n     - converter/\n       - userConverter.js\n       - projectConverter.js\n       - taskConverter.js\n   - api/\n     - userApi.js\n     - projectAndTaskApi.js\n```\n\n## Model層とService層とAPI層\n以下の３層に分離しまています。\n\n- Reactのコンポーネントで表示しやすいビューのためのモデル\n- ロジックとビューモデルを扱うService、APIを呼び出す。\n  - ServiceのモデルとAPIのリクエストとレスポンスを変換するConverter \n- Serviceから呼び出され、バックエンドのAPIを呼ぶAPI層\n\n### Model層\nビュー用のモデルを定義します。例えばUser,Project,Taskなどです。\nES2015のクラスで定義しています。\n\n```js:user.js\nexport default class User {\n  constructor(id, name, password, email) {\n    this.id = id\n    this.name = name\n    this.password = password\n    this.email = email\n  }\n  // ...\n}\n```\n\n### Service層\nビュー用モデルやそのパラメータを使ってロジックを実行する層です。\n非同期メソッドの場合は、createUserAsyncなどのようにAsyncをつけて命名します。\nAPI層を呼び出す前に、Converterでリクエストとレスポンスを変換します。\n\n### Service層のConverter\nAPIとサービスの橋渡しを行います。\nほとんどのメソッドは、パラメータやビューモデルと、リクエストとレスポンスの変換を行うだけになります。\n\n### API層\nバックエンドのAPIを呼び出すメソッドです。\n\nServiceとAPIとConverterは以下のようなコードになります。\n\n```js:userService.js\nclass UserService {\n\n  static createUserAsync = async (name, password, email) =\u003e {\n    const request = UserConverter.convertParamsToCreateUserRequest(name, password, email)\n    return UserApi.createUser(request)\n      .then(response =\u003e {\n        const createdUser = UserConverter.convertCreateUserResponseToUser(response)\n        return ({ createdUser })\n      })\n      .catch(error =\u003e ({ error }))\n  }\n  // ...\n}\n```\n\n# まとめ\nこの構成で半年近く実装していますが、特に違和感なく使えています。\n特にレイヤー化することで、以下の恩恵を受けています。\n\n- ModelとAPIの密結合を防ぐ\n- API変更は、API層とConverterのみにとじられる\n- ロジックはServiceに集約されるので、SagaやReducerが肥大化しない\n\nこの構成の例が参考になれば幸いです\n","coediting":false,"comments_count":0,"created_at":"2019-03-31T22:56:27+09:00","group":null,"id":"0515f00ec641d52f879b","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"React","versions":[]},{"name":"redux","versions":[]},{"name":"redux-saga","versions":[]}],"title":"React+Redux+APIサーバーでのアプリケーションのディレクトリ/ファイル構成","updated_at":"2019-03-31T22:58:28+09:00","url":"https://qiita.com/tashxii/items/0515f00ec641d52f879b","user":{"description":"tasとhxiiの共有Qiitaです。","facebook_id":"","followees_count":3,"followers_count":13,"github_login_name":"tashxii","id":"tashxii","items_count":20,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":180351,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/180351/profile-images/1553440575","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null}]